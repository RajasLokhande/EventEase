<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EventEase Optimized</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
/* --- Global & Reset --- */
body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; color: #333; transition: background-color 0.3s ease; }
section { display: none; min-height: 100vh; padding: 20px; box-sizing: border-box; position: relative; }

/* FIX: Added .center style for proper alignment on the home page */
.center {
    /* Ensures the content container is centered within the flex parent (#home) */
    text-align: center;
    max-width: 600px; /* Optional: limits width for better appearance */
}

/* --- Backgrounds & Layouts --- */
#home { background: radial-gradient(circle at top right, rgba(110, 197, 189, 0.3) 1%, transparent 50%), radial-gradient(circle at bottom left, rgba(162, 219, 215, 0.3) 1%, transparent 50%), #f0f8ff; display: flex; justify-content: center; align-items: center; flex-direction: column; }
#attendeeLogin, #attendeeRegister, #eventDetailPage, #ticketConfirmPage, #feedbackPage { background-color: #e6f7ff; display: flex; justify-content: center; align-items: center; }
#organizerLogin, #createEvent, #organizerRegister { background-color: #fffaf0; display: flex; justify-content: center; align-items: center; }
#eventsPage, #organizerDashboard { display: grid; grid-template-columns: 200px 1fr; padding: 0; }
#organizerDashboard { background-color: #fffaf0; }

/* FIX: Added style for the stats grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

/* --- Card/Container Styles --- */
.card-container { width: 100%; max-width: 700px; background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); text-align: center; box-sizing: border-box; }
.login-card { max-width: 400px; } 
.card-container.large-card { max-width: 800px; }
.card-container.medium-card { max-width: 580px; } 
.card-container.small-card { max-width: 450px; }
.card-container h2 { font-weight: 600; margin-bottom: 5px; color: #374151;}
.card-container p { font-size: 14px; color: #6b7280; margin-bottom: 30px;}

/* --- Navigation & Actions --- */
.top-action { position: absolute; top: 20px; left: 20px; color: #374151; font-size: 16px; cursor: pointer; display: flex; align-items: center; text-decoration: none; font-weight: 500; }
.top-action.right { left: auto; right: 20px; background-color: #f3f4f6; padding: 8px 12px; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); color: #374151; position: static !important;}
.top-action-icon { margin-right: 5px; font-size: 20px; }
.login-icon-box { width: 56px; height: 56px; border-radius: 12px; margin: 0 auto 20px; display: flex; justify-content: center; align-items: center; font-size: 32px; color: white; }
.login-icon-box.home-icon { background-color: #58C9B9; width: 60px; height: 60px; border-radius: 15px; }
.login-icon-box.attendee-icon { background-color: #00bcd4; }
.login-icon-box.organizer-icon { background-color: #ffb74d; }

/* --- Forms & Inputs --- */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px 30px; text-align: left; }
.full-width { grid-column: 1 / 3; }
.form-wrapper-left { width: 100%; text-align: left; }
.form-wrapper-left div { margin-bottom: 20px; }
.form-wrapper-left div:last-of-type { margin-bottom: 0; }
label { display: block; font-size: 14px; color: #6b7280; margin-bottom: 5px; font-weight: 500; }
input, textarea, select { width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #e5e7eb; font-size: 16px; box-sizing: border-box; background-color: #f9fafb; color: #374151; }

/* --- Buttons --- */
.btn-login { display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; padding: 15px; margin-top: 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; color: white; cursor: pointer; transition: background-color 0.2s; }
.btn-attendee-main { background-color: #00bcd4; }
.btn-organizer-main { background-color: #ffb74d; }
.btn-icon-right { font-size: 18px !important; vertical-align: middle; }
.btn-home-attendee { flex: 1; padding: 15px 20px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; color: white; cursor: pointer; background-color: #58C9B9; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
.btn-home-organizer { flex: 1; padding: 15px 20px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; color: white; cursor: pointer; background-color: #F7931E; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
.btn-gradient-orange { background: linear-gradient(to right, #ff9800, #ffb74d); margin-top: 40px; }
.btn-book-ticket { background: linear-gradient(to right, #ff9800, #ff8c00); margin-top: 40px; }

/* --- Dashboard & Sidebar --- */
.attendee-sidebar, .organizer-sidebar { background-color: #fff; padding: 20px 0; border-right: 1px solid #eee; }
.dashboard-main-content { padding: 40px; position: relative; }
.dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
.dashboard-header h1 { font-size: 24px; font-weight: 600; color: #374151; }
.sidebar-item, .sidebar-item-org { padding: 15px 20px; margin: 5px 0; font-size: 14px; font-weight: 500; color: #6b7280; cursor: pointer; display: flex; align-items: center; }
.attendee-sidebar-item.active, .attendee-sidebar-item:hover { background-color: #00bcd4; color: white; border-radius: 0 10px 10px 0; }
.sidebar-item-org.active, .sidebar-item-org:hover { background-color: #ffb74d; color: white; border-radius: 0 10px 10px 0; }
.sidebar-icon { margin-right: 10px; font-size: 20px !important; }

/* --- Events & Stats --- */
.events-banner { background: linear-gradient(to right, #00bcd4, #58C9B9); padding: 30px; border-radius: 15px; color: white; margin-bottom: 30px; text-align: left; position: relative; }
.btn-give-feedback { position: absolute; top: 25px; right: 30px; background-color: #ff9800; color: white; padding: 10px 15px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px; }
.events-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
.event-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); text-align: left; min-height: 300px; display: flex; flex-direction: column; justify-content: space-between; }
.event-detail-line { display: flex; align-items: center; margin-bottom: 8px; }
.event-detail-line .material-icons { font-size: 18px; margin-right: 8px; color: #00bcd4; }
.event-card .price { font-size: 20px; font-weight: 700; color: #ff9800; margin-top: 15px; }
.btn-view-book { background-color: #00bcd4; color: white; padding: 12px; border: none; border-radius: 8px; width: 100%; margin-top: 15px; font-weight: 600; cursor: pointer;}

/* --- Event Detail Fixes --- */
.detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left; margin-top: 30px; } 

.detail-item { 
    padding: 15px; border-radius: 10px; 
    display: flex; 
    align-items: center; 
    background-color: #f9fafb; 
    border: 1px solid #eee; 
    gap: 10px; 
    /* Allow content to stack vertically if needed, preventing overflow */
    flex-direction: column; 
    align-items: flex-start;
    padding: 10px 15px; /* Reduced vertical padding */
}
.detail-item .detail-text { 
    display: flex; 
    flex-direction: column; 
    width: 100%; /* Ensure text container takes full item width */
}
.detail-item .detail-text strong { font-weight: 600; font-size: 14px; }
.detail-item .detail-text span { font-size: 16px; margin-top: 2px; } /* Increased value font size for better display */

.detail-item .detail-icon {
    /* Push icon to the side and make it align nicely */
    font-size: 28px !important;
    margin-right: 0;
    margin-bottom: 5px;
    color: #00bcd4;
    width: 100%;
    text-align: center;
}

/* Special styling for Price/ID items to match the screenshot better (less text-heavy) */
.detail-item.price-item, .detail-item.id-item {
    /* Revert to original center/horizontal alignment for these simple fields */
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    height: 100px; /* Give them a fixed height to align with their neighbor cells */
}
.detail-item.price-item .detail-text, .detail-item.id-item .detail-text {
    align-items: center;
}
.detail-item.price-item .price-tag {
    font-size: 24px;
    font-weight: 700;
    margin-top: 5px;
}
.detail-item.id-item .detail-text span {
    font-size: 16px;
    font-weight: 600;
}
.detail-item.id-item .detail-icon { color: #58C9B9; }
.detail-item.price-item .detail-icon { color: #ff9800; }

/* --- Other Styles --- */
.rating-stars { font-size: 40px; color: #f7931e; cursor: pointer; margin: 20px 0 30px; }
.stat-card { padding: 25px; border-radius: 15px; background-color: white; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); display: flex; justify-content: space-between; align-items: center; border: 3px solid; }
.stat-card.card-blue-purple { border-color: #5e72e4; }
.stat-card.card-orange { border-color: #f5365c; }
.stat-card.card-teal { border-color: #2dce89; }
.stat-card .stat-icon { font-size: 40px !important; opacity: 0.8; }
.stat-card.card-blue-purple .stat-icon { color: #5e72e4; }
.stat-card.card-orange .stat-icon { color: #f5365c; }
.stat-card.card-teal .stat-icon { color: #2dce89; }
.stat-value { font-size: 32px; font-weight: 700; margin-top: 5px; color: #374151; }
.cta-banner-org { background: linear-gradient(to right, #f97316, #fb923c); padding: 30px; border-radius: 15px; color: white; margin-top: 30px; }
.btn-white-outline { background-color: white; color: #f97316; width: auto; padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; display: inline-flex; align-items: center; cursor: pointer; gap: 5px; margin-top: 15px;}

/* Fix for attendee sidebar welcome text */
.attendee-header {
    font-size: 16px;
    font-weight: 600;
    color: #374151;
    padding: 15px 20px;
    text-align: center;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
}

/* --- Organizer Table Styles --- */
.table-container {
    width: 100%;
    margin-top: 30px;
    margin-bottom: 30px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    overflow: hidden; /* Keeps borders rounded */
    overflow-x: auto; /* Prevents breaking sidebar if table gets too wide */
}

.dashboard-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
    text-align: left;
}

/* Orange Header Theme */
.dashboard-table thead {
    background: linear-gradient(to right, #ff9800, #ffb74d);
    color: white;
}

.dashboard-table th {
    padding: 18px 20px;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 13px;
    letter-spacing: 0.5px;
}

.dashboard-table td {
    padding: 15px 20px;
    border-bottom: 1px solid #f0f0f0;
    color: #374151;
    vertical-align: middle;
}

/* Hover Effect */
.dashboard-table tbody tr:hover {
    background-color: #fffaf0; /* Very light orange tint */
}

/* Action Buttons inside Table */
.btn-edit, .btn-delete {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    margin-right: 5px;
    transition: transform 0.2s;
}

.btn-edit {
    background-color: #e0f2fe;
    color: #0284c7; /* Blue for Edit */
}

.btn-delete {
    background-color: #fee2e2;
    color: #dc2626; /* Red for Delete */
}

.btn-edit:hover, .btn-delete:hover {
    transform: scale(1.05);
}

</style>
</head>
<body>

<script>
    // --- Global Configuration ---
    const API_BASE_URL = 'http://localhost:8080/api'; // Point to your Spring Boot Server

    // --- Global State ---
    let currentUser = null; // Stores the logged-in user object (Attendee or Organizer)
    let currentEventId = '';
    let currentEventDate = '';
    let events = []; // Will be populated from Backend

    // --- HELPER: Navigation ---
    window.showSection = (id, data = null) => {
        document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
        document.getElementById(id).style.display = (['organizerDashboard', 'eventsPage'].includes(id)) ? 'grid' : 'flex';

        if (id === 'eventsPage') {
            const firstName = currentUser ? currentUser.firstName : 'Guest';
            document.getElementById('attendeeWelcomeNameSidebar').innerText = firstName;
            document.getElementById('attendeeWelcomeNameHeader').innerText = `Welcome, ${firstName}!`;
            loadEvents(); // Fetch fresh data
        } else if (id === 'organizerDashboard') {
            const name = currentUser ? currentUser.name : 'Organizer';
            document.getElementById('organizerWelcomeHeader').innerText = `Welcome, ${name}!`;
            updateOrganizerStats();
            loadOrganizerEvents();
        } else if (id === 'eventDetailPage' && data) {
            loadEventDetails(data);
        } else if (id === 'feedbackPage') {
            setRating(0);
        }
    };

    // --- HELPER: Age Calculation (Frontend Logic) ---
    window.calculateAge = () => {
        const dob = document.getElementById('dob').value;
        const ageInput = document.getElementById('age');
        ageInput.value = '';
        if (!dob) return;
        const [birth, today] = [new Date(dob), new Date()];
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) age--;
        ageInput.value = age > 0 ? age : '';
    };

    // ============================================================
    //  BACKEND INTEGRATION FUNCTIONS
    // ============================================================

    // ************************************************************
    // [POST] Endpoint: /api/auth/attendee/register
    // Purpose: Register a new attendee
    // ************************************************************
    const registerAttendee = async () => {
        const data = {
            email: document.getElementById('email').value,
            firstName: document.getElementById('fname').value,
            lastName: document.getElementById('lname').value,
            phone: document.getElementById('phone').value,
            age: document.getElementById('age').value,
            password: document.getElementById('password').value
            // Backend can calculate age from DOB if sent, or send DOB directly
        };

        try {
            const response = await fetch(`${API_BASE_URL}/auth/attendee/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('Registration Successful! Please Login.');
                showSection('attendeeLogin');
            } else {
                alert('Registration Failed. Email or ID might be taken.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Server error during registration.');
        }
    };

    // ************************************************************
    // [POST] Endpoint: /api/auth/attendee/login
    // Purpose: Authenticate Attendee and get User Details
    // ************************************************************
    const loginAttendee = async () => {
        const email = document.getElementById('attendeeEmail').value;
        const password = document.getElementById('attendeePassword').value;

        try {
            const response = await fetch(`${API_BASE_URL}/auth/attendee/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            if (response.ok) {
                currentUser = await response.json(); // Backend returns User Object (id, name, etc.)
                showSection('eventsPage');
            } else {
                alert('Invalid Email or Password');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Cannot connect to login server.');
        }
    };

    // ************************************************************
    // [POST] Endpoint: /api/auth/organizer/register
    // Purpose: Register a new Organizer
    // ************************************************************
    const registerOrganizer = async () => {
        const data = {
            email: document.getElementById('orgEmailRegister').value,
            name: document.getElementById('orgNameRegister').value,
            phone: document.getElementById('orgPhoneRegister').value,
            password: document.getElementById('orgPassRegister').value
        };

        try {
            const response = await fetch(`${API_BASE_URL}/auth/organizer/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('Organizer Registration Successful!');
                showSection('organizerLogin');
            } else {
                alert('Registration Failed.');
            }
        } catch (error) {
            console.error(error);
            alert('Server Error.');
        }
    };

    window.deleteEvent = async (id) => {
    if (!confirm("Are you sure you want to delete this event? This cannot be undone.")) {
        return;
    }

    try {
        // NOTE: You need to add the DELETE endpoint to your Java Controller (see Part 2 below)
        const response = await fetch(`${API_BASE_URL}/events/${id}`, {
            method: 'DELETE'
        });

        if (response.ok) {
            alert("Event deleted successfully!");
            loadOrganizerEvents(); // Refresh the table
        } else {
            alert("Failed to delete event.");
        }
    } catch (error) {
        console.error("Delete error:", error);
        alert("Server error.");
    }
};

window.editEvent = (id) => {
    // 1. Find the event data from the global 'events' array
    const event = events.find(e => e.id == id);
    if (!event) return;

    // 2. Fill the form fields with existing data
    document.getElementById('eventId').value = event.id; // Crucial: This tells Backend to UPDATE, not CREATE
    document.getElementById('eventName').value = event.name;
    document.getElementById('duration').value = event.duration;
    document.getElementById('venueAddress').value = event.venueAddress;
    document.getElementById('venueCapacity').value = event.venueCapacity || '';
    document.getElementById('ticketPrice').value = event.ticketPrice;
    
    // Date formatting (HTML date input needs YYYY-MM-DD)
    if(event.date) {
        const d = new Date(event.date);
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        document.getElementById('eventDate').value = `${yyyy}-${mm}-${dd}`;
    }

    // 3. Change the Button Text to "Update Event" so the user knows
    const btn = document.getElementById('createEventBtn');
    btn.innerText = "Update Event";
    btn.onclick = createNewEvent; // Re-bind the function if needed

    // 4. Show the form
    showSection('createEvent');
};

    // ************************************************************
    // [POST] Endpoint: /api/auth/organizer/login
    // Purpose: Authenticate Organizer
    // ************************************************************
    const loginOrganizer = async () => {
        const email = document.getElementById('orgEmail').value;
        const password = document.getElementById('orgPass').value;

        try {
            const response = await fetch(`${API_BASE_URL}/auth/organizer/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            if (response.ok) {
                currentUser = await response.json();
                showSection('organizerDashboard');
            } else {
                alert('Invalid Organizer Credentials');
            }
        } catch (error) {
            console.error(error);
            alert('Login Error.');
        }
    };

    // ************************************************************
    // [GET] Endpoint: /api/events
    // Purpose: Load all available events from database
    // ************************************************************
    window.loadEvents = async () => {
        const eventList = document.getElementById('eventList');
        eventList.innerHTML = '<p style="grid-column:1/-1; text-align:center">Loading Events...</p>';

        try {
            const response = await fetch(`${API_BASE_URL}/events`);
            events = await response.json(); // Store in global variable

            eventList.innerHTML = '';
            events.forEach(event => {
                const dateString = new Date(event.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                eventList.innerHTML += `
                <div class="event-card">
                    <div>
                        <h4>${event.name}</h4>
                        <div class="event-detail-line"><span class="material-icons">location_on</span> ${event.venueAddress}</div>
                        <div class="event-detail-line"><span class="material-icons">calendar_today</span> ${dateString}</div>
                        <div class="event-detail-line"><span class="material-icons">schedule</span> ${event.duration}</div>
                    </div>
                    <div>
                        <div class="price">$${event.ticketPrice}</div>
                        <button class="btn-view-book" onclick="showSection('eventDetailPage', '${event.id}')">View & Book</button>
                    </div>
                </div>`;
            });

            if (events.length === 0) {
                eventList.innerHTML = "<p style='grid-column:1/-1; text-align:center'>No events found.</p>";
            }
        } catch (error) {
            console.error(error);
            eventList.innerHTML = "<p style='grid-column:1/-1; text-align:center; color:red'>Failed to connect to backend.</p>";
        }
    };

    // ************************************************************
    // [POST] Endpoint: /api/events
    // Purpose: Create a new event (Organizer Only)
    // ************************************************************
    const createNewEvent = async () => {
        const eventData = {
            id: document.getElementById('eventId').value || null, // Allow backend to generate if null
            name: document.getElementById('eventName').value,
            date: document.getElementById('eventDate').value,
            duration: document.getElementById('duration').value,
            budget: document.getElementById('budget').value,
            venueName: document.getElementById('venueId').value || null,
            venueAddress: document.getElementById('venueAddress').value,
            venueCapacity: document.getElementById('venueCapacity').value,
            ticketPrice: document.getElementById('ticketPrice').value.replace('$', ''),
            organizerId: currentUser ? currentUser.id : null // Link event to organizer
        };

        try {
            const response = await fetch(`${API_BASE_URL}/events`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(eventData)
            });

            if (response.ok) {
                alert('Event Created Successfully!');
                document.querySelectorAll('#createEvent input').forEach(i => i.value = '');
                showSection('organizerDashboard');
            } else {
                alert('Failed to create event.');
            }
        } catch (error) {
            console.error(error);
        }
    };

    // ************************************************************
    // [POST] Endpoint: /api/bookings
    // Purpose: Book a ticket
    // ************************************************************
    window.confirmTicketBooking = async (eventName) => {
        const bookingData = {
            eventId: currentEventId,
            attendeeId: currentUser ? currentUser.id : 'GUEST',
            bookingDate: new Date().toISOString()
        };

        try {
            const response = await fetch(`${API_BASE_URL}/bookings`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bookingData)
            });

            if (response.ok) {
                document.getElementById('bookedEventName').innerText = eventName;
                document.getElementById('bookedEventDate').innerText = 'Event Date: ' + new Date(currentEventDate).toLocaleDateString();
                showSection('ticketConfirmPage');
            } else {
                alert('Booking Failed. Sold out or Error.');
            }
        } catch (error) {
            console.error(error);
            alert('Booking System Error');
        }
    };

    // ************************************************************
    // [POST] Endpoint: /api/feedbacks
    // Purpose: Submit feedback
    // ************************************************************
    const submitFeedback = async () => {
        const rating = document.getElementById('feedbackRating').value;
        if (!rating) return alert('Select a rating!');

        const feedbackData = {
            attendeeId: document.getElementById('feedbackAttendeeId').value || (currentUser ? currentUser.id : 'Anon'),
            eventId: currentEventId || 'General',
            rating: rating,
            comments: document.getElementById('feedbackComments').value
        };

        try {
            const response = await fetch(`${API_BASE_URL}/feedbacks`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(feedbackData)
            });

            if (response.ok) {
                alert('Feedback Submitted!');
                document.getElementById('feedbackComments').value = '';
                setRating(0);
                showSection('eventsPage');
            }
        } catch (error) {
            console.error(error);
            alert('Could not submit feedback.');
        }
    };

    // ************************************************************
    // [GET] Endpoint: /api/organizers/{id}/stats
    // Purpose: Get dashboard stats (Simulated here, but set up for fetch)
    // ************************************************************
    window.updateOrganizerStats = async () => {
        // Example fetch logic if endpoint existed:
        // const response = await fetch(`${API_BASE_URL}/organizers/${currentUser.id}/stats`);
        // const stats = await response.json();
        
        // Fallback using loaded events
        document.getElementById('totalEvents').innerText = events.length; 
        document.getElementById('totalAttendees').innerText = '125'; 
        document.getElementById('totalFeedbacks').innerText = '42'; 
    };

    window.loadOrganizerEvents = async () => {
    const tableBody = document.getElementById('organizerEventTableBody');
    if (!tableBody) return; // Safety check

    tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center">Loading...</td></tr>';

    try {
        const response = await fetch(`${API_BASE_URL}/events`); // Fetches all events
        events = await response.json();

        tableBody.innerHTML = ''; // Clear loading message

        if (events.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center">No events found.</td></tr>';
            return;
        }

        events.forEach(event => {
            const dateString = new Date(event.date).toLocaleDateString();
            
            // Create a Table Row for each event
            tableBody.innerHTML += `
                <tr>
                    <td>${event.id}</td>
                    <td>${event.name}</td>
                    <td>${dateString}</td>
                    <td>$${event.ticketPrice}</td>
                    <td>
                        <button class="btn-edit" onclick="editEvent('${event.id}')">Edit</button>
                        <button class="btn-delete" onclick="deleteEvent('${event.id}')">Delete</button>
                    </td>
                </tr>
            `;
        });

    } catch (error) {
        console.error(error);
        tableBody.innerHTML = '<tr><td colspan="5" style="color:red; text-align:center">Failed to load data.</td></tr>';
    }
};

window.openCreateEventPage = () => {
    // 1. Clear all inputs
    document.querySelectorAll('#createEvent input').forEach(i => i.value = '');
    
    // 2. Reset Button Text to "Create" (in case it was set to "Update")
    const btn = document.getElementById('createEventBtn');
    if(btn) {
        btn.innerText = "Create Event";
        // Re-bind the create function if needed, though usually onclick stays valid
    }
    
    // 3. Show the section
    showSection('createEvent');
};

    // --- Helper for Details ---
    window.loadEventDetails = (eventId) => {
        const event = events.find(e => e.id === eventId);
        if (!event) return;
        currentEventId = event.id;
        currentEventDate = event.date;
        
        document.getElementById('detailEventTitle').innerText = event.name;
        document.getElementById('detailVenue').querySelector('span').innerText = event.venueAddress;
        document.getElementById('detailDate').querySelector('span').innerText = new Date(event.date).toLocaleDateString();
        document.getElementById('detailDuration').querySelector('span').innerText = event.duration;
        document.getElementById('detailCapacity').querySelector('span').innerText = event.venueCapacity;
        document.getElementById('detailPrice').querySelector('.price-tag').innerText = `$${event.ticketPrice}`;
        document.getElementById('detailId').querySelector('span').innerText = event.id;
        document.getElementById('bookTicketBtn').onclick = () => confirmTicketBooking(event.name);
    };

    window.setRating = (rating) => {
        document.getElementById('feedbackRating').value = rating;
        document.querySelectorAll('#feedbackStars .material-icons').forEach((star, index) => {
            star.innerText = index < rating ? 'star' : 'star_border';
        });
    };

    // --- Event Listeners (Binding Buttons to Functions) ---
    document.addEventListener('DOMContentLoaded', () => {
        showSection('home');

        document.getElementById('attendeeRegisterBtn').addEventListener('click', registerAttendee);
        document.getElementById('attendeeLoginBtn').addEventListener('click', loginAttendee);
        document.getElementById('organizerRegisterBtn').addEventListener('click', registerOrganizer);
        document.getElementById('organizerLoginBtn').addEventListener('click', loginOrganizer);
        document.getElementById('createEventBtn').addEventListener('click', createNewEvent);
        document.getElementById('submitFeedbackBtn').addEventListener('click', submitFeedback);
    });
</script>


<section id="home" style="display:flex;">
    <div class="center">
        <div class="login-icon-box home-icon"><span class="material-icons">calendar_today</span></div>
        <h1>Welcome to EventEase</h1>
        <p>Simplify your events â€” whether you're attending or organizing.</p>
        <div class="button-group">
            <button class="btn-home-attendee" onclick="showSection('attendeeLogin')"><span class="material-icons">person</span> I'm an Attendee</button>
            <button class="btn-home-organizer" onclick="showSection('organizerLogin')"><span class="material-icons">business_center</span> I'm an Organizer</button>
        </div>
        <p class="footer-text">&copy; 2025 EventEase. All Rights Reserved.</p>
    </div>
</section>

<section id="attendeeLogin">
    <a href="#" class="top-action" onclick="showSection('home'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back</a>
    <div class="card-container login-card">
        <div class="login-icon-box attendee-icon"><span class="material-icons">arrow_forward</span></div>
        <h2>Attendee Login</h2>
        <p>Sign in to explore and book events</p>
        <div class="form-wrapper-left">
            <div><label for="attendeeEmail">Email</label><input type="email" placeholder="your.email@example.com" id="attendeeEmail"></div>
            <div><label for="attendeePassword">Password</label><input type="password" placeholder="" id="attendeePassword"></div>
        </div>
        <button class="btn-login btn-attendee-main" id="attendeeLoginBtn">Login</button>
        <div class="login-footer">Don't have an account? <a href="#" onclick="showSection('attendeeRegister'); return false;" class="attendee-link">Register as New Attendee</a></div>
    </div>
</section>

<section id="attendeeRegister">
    <a href="#" class="top-action" onclick="showSection('attendeeLogin'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back</a>
    <div class="card-container">
        <h2>Attendee Registration</h2>
        <p>Join EventEase to discover amazing events</p>
        <div class="form-grid">
            <div><label for="attId">Attendee ID</label><input type="text" placeholder="ATD001" id="attId"></div>
            <div><label for="email">Email ID</label><input type="email" placeholder="your.email@example.com" id="email"></div>
            <div><label for="fname">First Name</label><input type="text" placeholder="John" id="fname"></div>
            <div><label for="mname">Middle Name</label><input type="text" placeholder="Michael" id="mname"></div>
            <div><label for="lname">Last Name</label><input type="text" placeholder="Doe" id="lname"></div>
            <div><label for="phone">Phone Number</label><input type="text" placeholder="+1 234 567 8900" id="phone"></div>
            <div><label for="dob">Date of Birth</label><input type="date" id="dob" onchange="calculateAge()"></div>
            <div><label for="age">Age (Auto-calculated)</label><input type="text" id="age" placeholder="" readonly></div>
            <div class="full-width"><label for="password">Password</label><input type="password" placeholder="" id="password"></div>
        </div>
        <button class="btn-login btn-attendee-main" id="attendeeRegisterBtn">Next <span class="material-icons btn-icon-right">arrow_forward</span></button>
    </div>
</section>

<section id="organizerLogin">
    <a href="#" class="top-action" onclick="showSection('home'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back</a>
    <div class="card-container login-card">
        <div class="login-icon-box organizer-icon"><span class="material-icons">arrow_forward</span></div>
        <h2>Organizer Login</h2>
        <p>Sign in to manage your events</p>
        <div class="form-wrapper-left">
            <div><label for="orgEmail">Email</label><input type="email" placeholder="organizer@example.com" id="orgEmail"></div>
            <div><label for="orgPass">Password</label><input type="password" placeholder="" id="orgPass"></div>
        </div>
        <button class="btn-login btn-organizer-main" id="organizerLoginBtn">Log In</button>
        <div class="login-footer">Don't have an account? <a href="#" onclick="showSection('organizerRegister'); return false;" class="organizer-link">Sign Up</a></div>
    </div>
</section>

<section id="organizerDashboard">
    <div class="organizer-sidebar">
        <div class="sidebar-item-org active">
            <span class="material-icons sidebar-icon">home</span> Dashboard Overview
        </div>
        <div class="sidebar-item-org" onclick="openCreateEventPage()">
            <span class="material-icons sidebar-icon">add</span> Create Event
        </div>
    </div>
    
    <div class="dashboard-main-content">
        
        <div class="dashboard-header">
            <h1 id="organizerWelcomeHeader">Welcome, Organizer!</h1>
            <a href="#" class="top-action right" onclick="showSection('home'); return false;">
                <span class="material-icons top-action-icon">logout</span> Logout
            </a>
        </div>

        <div class="stats-grid">
            <div class="stat-card card-blue-purple">
                <div>
                    <div class="stat-title">Total Attendees</div>
                    <div class="stat-value" id="totalAttendees">0</div>
                </div>
                <span class="material-icons stat-icon">people</span>
            </div>
            <div class="stat-card card-orange">
                <div>
                    <div class="stat-title">Events Organized</div>
                    <div class="stat-value" id="totalEvents">0</div>
                </div>
                <span class="material-icons stat-icon">calendar_today</span>
            </div>
            <div class="stat-card card-teal">
                <div>
                    <div class="stat-title">Total Feedbacks</div>
                    <div class="stat-value" id="totalFeedbacks">0</div>
                </div>
                <span class="material-icons stat-icon">comment</span>
            </div>
        </div>

        <div class="table-container">
            <div style="padding: 20px 20px 10px 20px; font-weight:700; color:#374151; font-size:18px;">
                Manage Events
            </div>
            <table class="dashboard-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Event Name</th>
                        <th>Date</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="organizerEventTableBody">
                    <tr><td colspan="5" style="text-align:center; padding: 20px;">Loading data...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="cta-banner-org">
            <h3>Ready to Create Something Amazing?</h3>
            <p>Design and launch your next event with our easy-to-use event creation tool.</p>
            <button class="btn-white-outline" onclick="openCreateEventPage()">
                <span class="material-icons">add</span> Create New Event
            </button>
        </div>
        
    </div>
</section>

<section id="organizerRegister">
    <a href="#" class="top-action" onclick="showSection('organizerLogin'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back</a>
    <div class="card-container login-card"> <h2>Organizer Registration</h2>
        <p>Create events and manage attendees</p>
        <div class="form-wrapper-left">
            <div><label for="orgIdRegister">Organizer ID</label><input type="text" placeholder="ORG001" id="orgIdRegister"></div>
            <div><label for="orgEmailRegister">Email</label><input type="email" placeholder="organizer@example.com" id="orgEmailRegister"></div>
            <div><label for="orgNameRegister">Name</label><input type="text" placeholder="John Doe" id="orgNameRegister"></div>
            <div><label for="orgPhoneRegister">Contact Number</label><input type="text" placeholder="+1 234 567 8900" id="orgPhoneRegister"></div>
            <div><label for="orgPassRegister">Password</label><input type="password" placeholder="" id="orgPassRegister"></div>
        </div>
        <button class="btn-login btn-organizer-main" id="organizerRegisterBtn">Next <span class="material-icons btn-icon-right">arrow_forward</span></button>
    </div>
</section>

<section id="organizerDashboard">
    <div class="organizer-sidebar">
        <div class="sidebar-item-org active"><span class="material-icons sidebar-icon">home</span> Dashboard Overview</div>
        <div class="sidebar-item-org" onclick="showSection('createEvent')"><span class="material-icons sidebar-icon">add</span> Create Event</div>
    </div>
    <div class="dashboard-main-content">
        <div class="dashboard-header">
            <h1 id="organizerWelcomeHeader">Welcome, Organizer!</h1>
            <a href="#" class="top-action right" onclick="showSection('home'); return false;">
                <span class="material-icons top-action-icon">logout</span> Logout
            </a>
        </div>
        <div class="stats-grid">
            <div class="stat-card card-blue-purple">
                <div><div class="stat-title">Total Attendees</div><div class="stat-value" id="totalAttendees">0</div></div><span class="material-icons stat-icon">people</span>
            </div>
            <div class="stat-card card-orange">
                <div><div class="stat-title">Events Organized</div><div class="stat-value" id="totalEvents">0</div></div><span class="material-icons stat-icon">calendar_today</span>
            </div>
            <div class="stat-card card-teal">
                <div><div class="stat-title">Total Feedbacks</div><div class="stat-value" id="totalFeedbacks">0</div></div><span class="material-icons stat-icon">comment</span>
            </div>
        </div>
        <div class="cta-banner-org">
            <h3>Ready to Create Something Amazing?</h3>
            <p>Design and launch your next event with our easy-to-use event creation tool.</p>
            <button class="btn-white-outline" onclick="showSection('createEvent')"><span class="material-icons">add</span> Create New Event</button>
        </div>
    </div>
</section>

<section id="createEvent">
    <a href="#" class="top-action" onclick="showSection('organizerDashboard'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back to Dashboard</a>
    <div class="card-container large-card">
        <h2>Create a New Event</h2>
        <div class="form-grid">
            <div><label for="eventId">Event ID</label><input type="text" placeholder="EVT001 (Auto-generated if empty)" id="eventId"></div>
            <div><label for="eventName">Event Name *</label><input type="text" placeholder="Tech Conference 2025" id="eventName"></div>
            <div><label for="eventDate">Date (DD/MM/YYYY) *</label><input type="date" id="eventDate"></div>
            <div><label for="duration">Duration</label><input type="text" placeholder="8 hours" id="duration"></div>
            <div><label for="budget">Budget</label><input type="text" placeholder="$50,000" id="budget"></div>
            <div><label for="venueId">Venue ID</label><input type="text" placeholder="VEN001" id="venueId"></div>
            <div class="full-width"><label for="venueAddress">Venue Address</label><input type="text" placeholder="123 Convention Center, Tech City" id="venueAddress"></div>
            <div><label for="venueCapacity">Venue Capacity</label><input type="number" placeholder="500" id="venueCapacity"></div>
            <div><label for="ticketPrice">Ticket Price *</label><input type="text" placeholder="$99" id="ticketPrice"></div>
        </div>
        <button class="btn-login btn-gradient-orange" id="createEventBtn">Create Event</button>
    </div>
</section>

<section id="eventsPage">
    <div class="attendee-sidebar">
        <div class="attendee-header">Welcome, <span id="attendeeWelcomeNameSidebar">Attendee</span>!</div> 
        <div class="sidebar-item active" onclick="showSection('eventsPage')"><span class="material-icons sidebar-icon">home</span> Home</div>
        <div class="sidebar-item" onclick="showSection('feedbackPage')"><span class="material-icons sidebar-icon">feedback</span> Feedback</div>
    </div>
    <div class="dashboard-main-content">
        <div class="dashboard-header">
            <h1 id="attendeeWelcomeNameHeader">Welcome, Attendee!</h1>
            <a href="#" class="top-action right" onclick="showSection('home'); return false;">
                <span class="material-icons top-action-icon">logout</span> Logout
            </a>
        </div>
        <div class="events-banner">
            <h3>Your Event Journey Starts Here</h3>
            <p>Discover and book from our curated selection of events</p>
            <button class="btn-give-feedback" onclick="showSection('feedbackPage')">Give Feedback</button>
        </div>
        <h3 style="font-weight: 600; color: #374151;">Available Events</h3>
        <div class="events-grid" id="eventList"></div>
    </div>
</section>

<section id="eventDetailPage">
    <a href="#" class="top-action" onclick="showSection('eventsPage'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back to Dashboard</a>
    <div class="card-container medium-card">
        <h2 id="detailEventTitle">Music Festival</h2>
        <div class="detail-grid">
            <div class="detail-item" id="detailVenue"><span class="material-icons detail-icon">location_on</span><div class="detail-text"><strong>Venue</strong><span>456 Outdoor Arena, Music Valley</span></div></div>
            <div class="detail-item" id="detailCapacity"><span class="material-icons detail-icon">people</span><div class="detail-text"><strong>Venue Capacity</strong><span>2000 people</span></div></div>
            <div class="detail-item" id="detailDate"><span class="material-icons detail-icon">calendar_today</span><div class="detail-text"><strong>Date</strong><span>December 20, 2025</span></div></div>
            <div class="detail-item price-item" id="detailPrice"><span class="material-icons detail-icon">payments</span><div class="detail-text"><strong>Ticket Price</strong><span class="price-tag">$149</span></div></div>
            <div class="detail-item" id="detailDuration"><span class="material-icons detail-icon">schedule</span><div class="detail-text"><strong>Duration</strong><span>12 hours</span></div></div>
            <div class="detail-item id-item" id="detailId"><span class="material-icons detail-icon">info</span><div class="detail-text"><strong>Event ID</strong><span>EVT002</span></div></div>
        </div>
        <button class="btn-login btn-book-ticket" id="bookTicketBtn">Book Ticket</button>
    </div>
</section>

<section id="ticketConfirmPage">
    <div class="card-container login-card confirm-card small-card">
        <span class="material-icons confirm-icon">check_circle</span>
        <h2>Ticket Booked Successfully!</h2>
        <p>Your ticket for <strong id="bookedEventName">Music Festival</strong> has been confirmed.</p>
        <p class="date" id="bookedEventDate">Event Date: December 20, 2025</p>
        <button class="btn-login btn-attendee-main" onclick="showSection('eventsPage')">Exit to Dashboard</button>
    </div>
</section>

<section id="feedbackPage">
    <a href="#" class="top-action" onclick="showSection('eventsPage'); return false;"><span class="material-icons top-action-icon">arrow_back</span> Back to Dashboard</a>
    <div class="card-container login-card feedback-card">
        <h2>Event Feedback</h2>
        <div class="form-wrapper-left">
            <div><label for="feedbackAttendeeId">Attendee ID</label><input type="text" placeholder="007" id="feedbackAttendeeId"></div>
            <div><label>Rating</label></div>
        </div>
        <div class="rating-stars" id="feedbackStars">
            <span class="material-icons" onclick="setRating(1)">star_border</span>
            <span class="material-icons" onclick="setRating(2)">star_border</span>
            <span class="material-icons" onclick="setRating(3)">star_border</span>
            <span class="material-icons" onclick="setRating(4)">star_border</span>
            <span class="material-icons" onclick="setRating(5)">star_border</span>
            <input type="hidden" id="feedbackRating" value="">
        </div>
        <div class="form-wrapper-left">
              <div><label for="feedbackComments">Comments (Optional)</label><textarea id="feedbackComments" placeholder="Share your experience with us..."></textarea></div>
        </div>
        <button class="btn-login btn-gradient-orange" id="submitFeedbackBtn">Submit Feedback</button>
    </div>
</section>

</body>
</html>